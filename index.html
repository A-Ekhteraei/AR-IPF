<script>
    AFRAME.registerComponent('toggle-rotation', {
        init: function() {
            this.isRotating = false;
            this.rotationAngle = 0;
            
            this.el.addEventListener('click', () => {
                this.toggleRotation();
            });
            
            this.el.addEventListener('touchstart', () => {
                this.toggleRotation();
            });
        },
        
        toggleRotation: function() {
            if (this.isRotating) {
                // Stop any ongoing animation
                const anim = this.el.components['animation__rotation'];
                if (anim) {
                    this.el.removeAttribute('animation__rotation');
                }
                this.isRotating = false;
            } else {
                // Remove any existing animation first
                this.el.removeAttribute('animation__rotation');
                
                // Force A-Frame to clean up
                setTimeout(() => {
                    this.el.setAttribute('animation__rotation', {
                        property: 'rotation',
                        to: {x: 0, y: 360, z: 0},
                        dur: 10000,
                        loop: true,
                        easing: 'linear'
                    });
                    this.isRotating = true;
                }, 50); // Small delay to ensure cleanup
            }
        }
    });
</script>
